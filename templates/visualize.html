    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="../static/logo.jpg" type="image/x-icon">
        <title>Sentiment Visualization</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                margin: 0;
                padding: 0;
                color: #333;
            }
            .container {
                max-width: 1200px;
                margin: 50px auto;
                background: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            }
            h1 {
                color: #4a4a4a;
                margin-bottom: 30px;
                text-align: center;
            }
            .chart-container {
                margin: 40px 0;
                padding: 20px;
                background: #f9f9f9;
                border-radius: 8px;
            }
            canvas {
                max-width: 100%;
                height: auto;
            }
            a {
                color: #667eea;
                text-decoration: none;
                font-weight: bold;
            }
            a:hover {
                text-decoration: underline;
            }
            .no-data {
                color: #777;
                font-style: italic;
                text-align: center;
            }
            .filter {
                margin-bottom: 20px;
                text-align: center;
            }
            .filter select {
                padding: 8px;
                border-radius: 5px;
                border: 1px solid #ddd;
            }
            .charts-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }
            @media (max-width: 1024px) {
                .charts-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
            }
            @media (max-width: 768px) {
                .container {
                    margin: 20px auto;
                    padding: 20px;
                }
                h1 {
                    font-size: 24px;
                }
                .summary {
                    flex-direction: column;
                    gap: 15px;
                }
                .summary-item {
                    text-align: center;
                }
                .charts-grid {
                    grid-template-columns: 1fr;
                    gap: 15px;
                }
                .chart-container {
                    padding: 15px;
                }
                .filter select {
                    width: 100%;
                    margin-top: 10px;
                }
                .footer {
                    grid-template-columns: 1fr;
                    gap: 15px;
                    padding: 20px 10px;
                }
                .footer img, .footer p, .footer .social-links {
                    justify-self: center;
                }
            }
            @media (max-width: 480px) {
                .container {
                    margin: 10px;
                    padding: 15px;
                }
                h1 {
                    font-size: 20px;
                }
                .summary {
                    padding: 15px;
                }
                .summary-item h3 {
                    font-size: 16px;
                }
                .summary-item p {
                    font-size: 18px;
                }
                .chart-container {
                    padding: 10px;
                }
                .footer {
                    font-size: 14px;
                }
                .footer img {
                    height: 40px;
                }
            }
            .summary {
                display: flex;
                justify-content: space-around;
                margin-bottom: 30px;
                background: #f0f8ff;
                padding: 20px;
                border-radius: 8px;
            }
            .summary-item {
                text-align: center;
            }
            .summary-item h3 {
                margin: 0;
                color: #4a4a4a;
            }
            .summary-item p {
                margin: 5px 0 0 0;
                font-size: 24px;
                font-weight: bold;
                color: #667eea;
            }
            .export-btn {
                margin-top: 10px;
                padding: 8px 16px;
                background: #28a745;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
            }
            .export-btn:hover {
                background: #218838;
            }
            .footer {
                background: linear-gradient(135deg, #f0f2f5 0%, #e0e7ff 100%);
                padding: 30px 20px;
                color: #555;
                font-size: 16px;
                border-top: 2px solid #ddd;
                display: grid;
                grid-template-columns: 1fr auto 1fr;
                align-items: center;
                justify-items: center;
                animation: fadeIn 1s ease-in-out;
            }
            .footer img {
                height: 60px;
                justify-self: start;
            }
            .footer p {
                justify-self: center;
            }
            .footer .social-links {
                justify-self: end;
            }
            .footer .social-links a {
                color: #333;
                margin: 0 15px;
                transition: color 0.3s ease;
            }
            .footer .social-links a:hover {
                color: #667eea;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
        </style>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    </head>
    <body>
        <div class="container">
            <h1>Sentiment Analysis Dashboard</h1>
            {% if data_json == 'null' %}
                <p class="no-data">No sentiment data available. Please analyze some text first.</p>
            {% else %}
                <div class="filter">
                    <label for="chartType">Chart Type: </label>
                    <select id="chartType">
                        <option value="pie">Pie Chart</option>
                        <option value="bar">Bar Chart</option>
                    </select>
                </div>
                <div class="summary">
                    <div class="summary-item">
                        <h3>Total Analyses</h3>
                        <p id="total-analyses">0</p>
                    </div>
                    <div class="summary-item">
                        <h3>Average Polarity</h3>
                        <p id="avg-polarity">0.00</p>
                    </div>
                    <div class="summary-item">
                        <h3>Most Common Emotion</h3>
                        <p id="common-emotion">None</p>
                    </div>
                </div>
                <div class="charts-grid">
                    <div class="chart-container">
                        <h2>Sentiment Distribution</h2>
                        <canvas id="sentimentChart" width="400" height="200"></canvas>
                    </div>
                    <div class="chart-container">
                        <h2>Polarity Trends</h2>
                        <canvas id="polarityChart" width="400" height="200"></canvas>
                    </div>
                    <div class="chart-container">
                        <h2>Emotion Distribution</h2>
                        <canvas id="emotionChart" width="400" height="200"></canvas>
                    </div>
                    <div class="chart-container">
                        <h2>Aspect Sentiment Analysis</h2>
                        <canvas id="aspectChart" width="400" height="200"></canvas>
                        <button class="export-btn" onclick="exportChart('aspectChart')">Export PNG</button>
                    </div>
                    <div class="chart-container">
                        <h2>Polarity Histogram</h2>
                        <canvas id="polarityHistChart" width="400" height="200"></canvas>
                        <button class="export-btn" onclick="exportChart('polarityHistChart')">Export PNG</button>
                    </div>
                    <div class="chart-container">
                        <h2>Top Topic Words</h2>
                        <canvas id="topicsChart" width="400" height="200"></canvas>
                        <button class="export-btn" onclick="exportChart('topicsChart')">Export PNG</button>
                    </div>
                </div>
            {% endif %}
            <p style="text-align: center;"><a href="/">Back to Analysis</a></p>
        </div>
        <footer class="footer">
            <img src="/static/logo.jpg" alt="Logo">
            <p>&copy; 2026 Sentiment Analysis Web App | Powered by <a href="" target="_blank"> IDXâˆž </a></p>
            <div class="social-links">
                <a href="https://github.com/Sam-13s" target="_blank"><i class="fab fa-github fa-lg"></i></a>
                <a href="http://linkedin.com/in/samir13" target="_blank"><i class="fab fa-linkedin fa-lg"></i></a>
            </div>
        </footer>
        <script>
            {% if data_json != 'null' %}
            const data = JSON.parse('{{ data_json|safe }}');
            let sentimentChart;

            function createSentimentChart(type) {
                const ctx = document.getElementById('sentimentChart').getContext('2d');
                if (sentimentChart) {
                    sentimentChart.destroy();
                }
                sentimentChart = new Chart(ctx, {
                    type: type,
                    data: {
                        labels: ['Positive', 'Negative', 'Neutral'],
                        datasets: [{
                            label: 'Sentiment Count',
                            data: [data.positive, data.negative, data.neutral],
                            backgroundColor: ['#28a745', '#dc3545', '#ffc107'],
                            borderColor: ['#28a745', '#dc3545', '#ffc107'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.parsed.y;
                                    }
                                }
                            }
                        },
                        scales: type === 'bar' ? {
                            y: {
                                beginAtZero: true
                            }
                        } : {}
                    }
                });
            }

            // Polarity Line Chart
            const polarityCtx = document.getElementById('polarityChart').getContext('2d');
            const polarityChart = new Chart(polarityCtx, {
                type: 'line',
                data: {
                    labels: data.polarities.map((_, i) => `Analysis ${i+1}`),
                    datasets: [{
                        label: 'Polarity Score',
                        data: data.polarities,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Polarity: ' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1
                        }
                    }
                }
            });

            // Emotion Bar Chart
            const emotionCtx = document.getElementById('emotionChart').getContext('2d');
            const emotionLabels = Object.keys(data.emotion_counts);
            const emotionData = Object.values(data.emotion_counts);
            const emotionChart = new Chart(emotionCtx, {
                type: 'bar',
                data: {
                    labels: emotionLabels,
                    datasets: [{
                        label: 'Emotion Count',
                        data: emotionData,
                        backgroundColor: '#ff6384',
                        borderColor: '#ff6384',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Aspect Stacked Bar Chart
            const aspectCtx = document.getElementById('aspectChart').getContext('2d');
            const aspectLabels = Object.keys(data.aspects);
            const positiveAspects = aspectLabels.map(aspect => data.aspects[aspect].Positive);
            const negativeAspects = aspectLabels.map(aspect => data.aspects[aspect].Negative);
            const neutralAspects = aspectLabels.map(aspect => data.aspects[aspect].Neutral);
            const aspectChart = new Chart(aspectCtx, {
                type: 'bar',
                data: {
                    labels: aspectLabels,
                    datasets: [
                        {
                            label: 'Positive',
                            data: positiveAspects,
                            backgroundColor: '#28a745'
                        },
                        {
                            label: 'Negative',
                            data: negativeAspects,
                            backgroundColor: '#dc3545'
                        },
                        {
                            label: 'Neutral',
                            data: neutralAspects,
                            backgroundColor: '#ffc107'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });

            // Initial chart
            createSentimentChart('pie');

            // Summary calculations
            const totalAnalyses = data.polarities.length;
            const avgPolarity = data.polarities.reduce((a, b) => a + b, 0) / totalAnalyses;
            const mostCommonEmotion = Object.keys(data.emotion_counts).reduce((a, b) => data.emotion_counts[a] > data.emotion_counts[b] ? a : b, 'None');

            document.getElementById('total-analyses').textContent = totalAnalyses;
            document.getElementById('avg-polarity').textContent = avgPolarity.toFixed(2);
            document.getElementById('common-emotion').textContent = mostCommonEmotion;

            // Polarity Histogram
            const polarityHistCtx = document.getElementById('polarityHistChart').getContext('2d');
            const bins = [0, 0.2, 0.4, 0.6, 0.8, 1];
            const histData = bins.map(() => 0);
            data.polarities.forEach(p => {
                const bin = Math.floor(p / 0.2);
                if (bin < histData.length) histData[bin]++;
            });
            const polarityHistChart = new Chart(polarityHistCtx, {
                type: 'bar',
                data: {
                    labels: bins.map((b, i) => `${b.toFixed(1)}-${(b + 0.2).toFixed(1)}`),
                    datasets: [{
                        label: 'Frequency',
                        data: histData,
                        backgroundColor: '#17a2b8',
                        borderColor: '#17a2b8',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuad'
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Count: ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Topics Bar Chart
            const topicsCtx = document.getElementById('topicsChart').getContext('2d');
            const wordCounts = {};
            data.topics.forEach(topic => {
                topic.split(' ').forEach(word => {
                    wordCounts[word] = (wordCounts[word] || 0) + 1;
                });
            });
            const topWords = Object.entries(wordCounts).sort((a, b) => b[1] - a[1]).slice(0, 10);
            const topicsChart = new Chart(topicsCtx, {
                type: 'bar',
                data: {
                    labels: topWords.map(w => w[0]),
                    datasets: [{
                        label: 'Frequency',
                        data: topWords.map(w => w[1]),
                        backgroundColor: '#6f42c1',
                        borderColor: '#6f42c1',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuad'
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Export function
            function exportChart(chartId) {
                const canvas = document.getElementById(chartId);
                const link = document.createElement('a');
                link.download = chartId + '.png';
                link.href = canvas.toDataURL();
                link.click();
            }

            // Chart type switcher
            document.getElementById('chartType').addEventListener('change', function() {
                createSentimentChart(this.value);
            });
            {% endif %}
        </script>
    </body>
    </html>
